{% from "_forms.html" import render_field %}

<div class="card shadow-sm mb-4">
  <div class="card-body p-4">
    <h2 class="h5 mb-3">Create a post</h2>
    <form method="post" novalidate>
      {{ post_form.hidden_tag() }}

      <div class="mb-3">
        {{ post_form.body.label(class="form-label") }}
        {% set classes = "form-control" + (" is-invalid" if post_form.body.errors else "") %}
        {{ post_form.body(class=classes, rows=3, maxlength="255", placeholder="Share something...") }}
        {% if post_form.body.errors %}
          <div class="invalid-feedback">{{ post_form.body.errors[0] }}</div>
        {% endif %}
        <div class="form-text">
          <span id="post-body-count">0</span>/255
        </div>
      </div>

      {{ render_field(post_form.tags, placeholder="e.g. flask, tips") }}

      <button class="btn btn-primary" type="submit">{{ post_form.submit.label.text }}</button>
    </form>
  </div>
</div>

<script>
  // Lightweight character counter for body
  (function () {
    const ta = document.getElementById("{{ post_form.body.id }}");
    const counter = document.getElementById("post-body-count");
    if (ta && counter) {
      const update = () => counter.textContent = (ta.value || "").length;
      ta.addEventListener("input", update);
      update();
    }
  })();
</script>
